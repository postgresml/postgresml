<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="In PostgresML 2.0, we'd like to address runtime speed, memory consumption and the overall reliability we've seen for machine learning deployments running at scale, in addition to simplifying the workflow for building and deploying models." name=description><meta content="Montana Low" name=author><link href=https://postgresml.org/blog/postgresml-is-moving-to-rust-for-our-2.0-release/ rel=canonical><link href=/images/owl.ico rel=icon><meta content="mkdocs-1.4.2, mkdocs-material-8.5.10" name=generator><meta content=PostgresML property=og:site_name><meta content="PostgresML is Moving to Rust for our 2.0 Release" property=og:title><meta content="In PostgresML 2.0, we'd like to address runtime speed, memory consumption and the overall reliability we've seen for machine learning deployments running at scale, in addition to simplifying the workflow for building and deploying models." property=og:description><meta content="Montana Low" property=og:author><meta content=https://postgresml.org/blog/images/rust_programming_crab_sea.jpg property=og:image><meta content="Moving from one abstraction layer to another." property=og:image:alt><meta content=article property=og:type><title>PostgresML is Moving to Rust for our 2.0 Release - PostgresML</title><link href=../../assets/stylesheets/main.975780f9.min.css rel=stylesheet><link href=../../assets/stylesheets/palette.2505c338.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script async data-website-id=499122fd-f307-4e8d-af4b-88b9f5e9903b defer src=https://data.cloud.hyperparam.ai/umami.js>
</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src=../../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent=blue data-md-color-primary=indigo data-md-color-scheme=default dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#postgresml-is-moving-to-rust-for-our-20-release> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label=PostgresML class="md-header__button md-logo" data-md-component=logo href=../.. title=PostgresML> <img alt=logo src=/images/owl_white.png> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Postgres<span style="color: dodgerblue">ML</span> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> PostgresML is Moving to Rust for our 2.0 Release </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent=blue data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary=indigo data-md-color-scheme=default id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg> </label> <input aria-label="Switch to light mode" class=md-option data-md-color-accent=blue data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary=blue data-md-color-scheme=slate id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a class=md-source data-md-component=source href=https://github.com/postgresml/postgresml title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> postgresml/postgresml </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav aria-label=Tabs class=md-tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a class=md-tabs__link href=../..> PostgresML </a> </li> <li class=md-tabs__item> <a href=../../user_guides/setup/quick_start_with_docker/ class=md-tabs__link> User Guides </a> </li> <li class=md-tabs__item> <a href=../../developer_guide/overview/ class=md-tabs__link> Developer Guide </a> </li> <li class=md-tabs__item> <a href=../data-is-living-and-relational/ class="md-tabs__link md-tabs__link--active"> Blog </a> </li> <li class=md-tabs__item> <a href=../../about/team/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary md-nav--lifted" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label=PostgresML class="md-nav__button md-logo" data-md-component=logo href=../.. title=PostgresML> <img alt=logo src=/images/owl_white.png> </a> Postgres<span style="color: dodgerblue">ML</span> </label> <div class=md-nav__source> <a class=md-source data-md-component=source href=https://github.com/postgresml/postgresml title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> postgresml/postgresml </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../..> PostgresML </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 id=__nav_2 type=checkbox> <label class=md-nav__link for=__nav_2> User Guides <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="User Guides" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1 id=__nav_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_1> Setup <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Setup class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Setup </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user_guides/setup/quick_start_with_docker/ class=md-nav__link> Quick Start with Docker </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_1_2 id=__nav_2_1_2 type=checkbox> <label class=md-nav__link for=__nav_2_1_2> Installation <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Installation class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_1_2> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user_guides/setup/v2/installation/ class=md-nav__link> v2.0 </a> </li> <li class=md-nav__item> <a href=../../user_guides/setup/v2/upgrade-from-v1/ class=md-nav__link> Upgrading from v1.0 to v2.0 </a> </li> <li class=md-nav__item> <a href=../../user_guides/setup/installation/ class=md-nav__link> v1.0 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../user_guides/setup/distributed_training/ class=md-nav__link> Distributed Training </a> </li> <li class=md-nav__item> <a href=../../user_guides/setup/gpu_support/ class=md-nav__link> GPU Support </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 id=__nav_2_2 type=checkbox> <label class=md-nav__link for=__nav_2_2> Training <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Training class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Training </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user_guides/training/overview/ class=md-nav__link> Training Overview </a> </li> <li class=md-nav__item> <a href=../../user_guides/training/algorithm_selection/ class=md-nav__link> Algorithm Selection </a> </li> <li class=md-nav__item> <a href=../../user_guides/training/preprocessing/ class=md-nav__link> Preprocessing Data </a> </li> <li class=md-nav__item> <a href=../../user_guides/training/hyperparameter_search/ class=md-nav__link> Hyperparameter Search </a> </li> <li class=md-nav__item> <a href=../../user_guides/training/joint_optimization/ class=md-nav__link> Joint Optimization </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 id=__nav_2_3 type=checkbox> <label class=md-nav__link for=__nav_2_3> Predictions <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Predictions class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Predictions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user_guides/predictions/overview/ class=md-nav__link> Prediction Overview </a> </li> <li class=md-nav__item> <a href=../../user_guides/predictions/batch/ class=md-nav__link> Batch Predictions </a> </li> <li class=md-nav__item> <a href=../../user_guides/predictions/deployments/ class=md-nav__link> Deploying Models </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../user_guides/vector_operations/overview/ class=md-nav__link> Vector Operations </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_5 id=__nav_2_5 type=checkbox> <label class=md-nav__link for=__nav_2_5> Transformers <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Transformers class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> Transformers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user_guides/transformers/setup/ class=md-nav__link> Setup </a> </li> <li class=md-nav__item> <a href=../../user_guides/transformers/pre_trained_models/ class=md-nav__link> Pre-Trained Models </a> </li> <li class=md-nav__item> <a href=../../user_guides/transformers/fine_tuning/ class=md-nav__link> Fine Tuning </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../user_guides/dashboard/overview/ class=md-nav__link> Dashboard </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_7 id=__nav_2_7 type=checkbox> <label class=md-nav__link for=__nav_2_7> Schema <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Schema class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> Schema </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user_guides/schema/models/ class=md-nav__link> Models </a> </li> <li class=md-nav__item> <a href=../../user_guides/schema/snapshots/ class=md-nav__link> Snapshots </a> </li> <li class=md-nav__item> <a href=../../user_guides/schema/projects/ class=md-nav__link> Projects </a> </li> <li class=md-nav__item> <a href=../../user_guides/schema/deployments/ class=md-nav__link> Deployments </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 id=__nav_3 type=checkbox> <label class=md-nav__link for=__nav_3> Developer Guide <span class="md-nav__icon md-icon"></span> </label> <nav aria-label="Developer Guide" class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Developer Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer_guide/overview/ class=md-nav__link> Developer Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 id=__nav_4 type=checkbox> <label class=md-nav__link for=__nav_4> Blog <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=Blog class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../data-is-living-and-relational/ class=md-nav__link> Data is Living and Relational </a> </li> <li class=md-nav__item> <a href=../postgres-full-text-search-is-awesome/ class=md-nav__link> Postgres Full Text Search is Awesome </a> </li> <li class=md-nav__item> <a href=../which-database-that-is-the-question/ class=md-nav__link> Which Database, That is the Question </a> </li> <li class=md-nav__item> <a href=../oxidizing-machine-learning/ class=md-nav__link> Oxidizing Machine Learning </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> PostgresML is Moving to Rust for our 2.0 Release <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> PostgresML is Moving to Rust for our 2.0 Release </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#ambition-starts-with-a-simple-benchmark> Ambition Starts With a Simple Benchmark </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#what-about-xgboost-and-friends> What about XGBoost and friends? </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#preserving-backward-compatibility> Preserving Backward Compatibility </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#ensuring-high-quality-rust-implementations> Ensuring High Quality Rust Implementations </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../backwards-compatible-or-bust-python-inside-rust-inside-postgres/ class=md-nav__link> Backwards Compatible or Bust: Python Inside Rust Inside Postgres </a> </li> <li class=md-nav__item> <a href=../postgresml-is-8x-faster-than-python-http-microservices/ class=md-nav__link> PostgresML is 8-40x faster than Python HTTP microservices </a> </li> <li class=md-nav__item> <a href=../scaling-postgresml-to-one-million-requests-per-second/ class=md-nav__link> Scaling PostgresML to 1 Million Requests per Second </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 id=__nav_5 type=checkbox> <label class=md-nav__link for=__nav_5> About <span class="md-nav__icon md-icon"></span> </label> <nav aria-label=About class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../about/team/ class=md-nav__link> Team </a> </li> <li class=md-nav__item> <a href=../../about/roadmap/ class=md-nav__link> Roadmap </a> </li> <li class=md-nav__item> <a href=../../about/motivation/ class=md-nav__link> Motivation </a> </li> <li class=md-nav__item> <a href=../../about/faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../../about/license/ class=md-nav__link> License </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#ambition-starts-with-a-simple-benchmark> Ambition Starts With a Simple Benchmark </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#what-about-xgboost-and-friends> What about XGBoost and friends? </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#preserving-backward-compatibility> Preserving Backward Compatibility </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#ensuring-high-quality-rust-implementations> Ensuring High Quality Rust Implementations </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a class="md-content__button md-icon" href=https://github.com/postgresml/postgresml/blob/master/pgml-docs/docs/blog/postgresml-is-moving-to-rust-for-our-2.0-release.md title="Edit this page"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"></path></svg> </a> <h1 id=postgresml-is-moving-to-rust-for-our-20-release>PostgresML is Moving to Rust for our 2.0 Release<a class=headerlink href=#postgresml-is-moving-to-rust-for-our-20-release title="Permanent link">¶</a></h1> <p class=author> <a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=/images/team/montana.jpg><img height=54px src=/images/team/montana.jpg width=54px></a> Montana Low<br> September 19, 2022 </p> <p>PostgresML is a fairly young project. We recently released v1.0 and now we're considering what we want to accomplish for v2.0. In addition to simplifying the workflow for building models, we'd like to address runtime speed, memory consumption and the overall reliability we've seen is needed for machine learning deployments running at scale.</p> <p>Python is generally touted as fast enough for machine learning, and is the de facto industry standard with tons of popular libraries, implementing all the latest and greatest algorithms. Many of these algorithms (Torch, Tensorflow, XGboost, NumPy) have been optimized in C, but not all of them. For example, most of the <a href=https://github.com/scikit-learn/scikit-learn/tree/main/sklearn/linear_model>linear algorithms</a> in scikit-learn are written in pure Python, although they do use NumPy, which is a convenient optimization. It also uses Cython in a few performance critical places. This ecosystem has allowed PostgresML to offer a ton of functionality with minimal duplication of effort.</p> <h2 id=ambition-starts-with-a-simple-benchmark>Ambition Starts With a Simple Benchmark<a class=headerlink href=#ambition-starts-with-a-simple-benchmark title="Permanent link">¶</a></h2> <figure> <a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=/blog/images/rust_programming_crab_sea.webp><img alt="Ferris the crab" src=/blog/images/rust_programming_crab_sea.webp></a> <figcaption>Rust mascot image by opensource.com</figcaption> </figure> <p>To illustrate our motivation, we'll create a test set of 10,000 random embeddings with 128 dimensions, and store them in a table. Our first benchmark will simulate semantic ranking, by computing the dot product against every member of the test set, sorting the results and returning the top match.</p> <div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>generate_embeddings.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1>1</a></span>
<span class=normal><a href=#__codelineno-0-2>2</a></span>
<span class=normal><a href=#__codelineno-0-3>3</a></span>
<span class=normal><a href=#__codelineno-0-4>4</a></span>
<span class=normal><a href=#__codelineno-0-5>5</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=c1>-- Generate 10,000 embeddings with 128 dimensions as FLOAT4[] type.</span>
<a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>embeddings</span><span class=w> </span><span class=k>AS</span><span class=w> </span>
<a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=k>SELECT</span><span class=w> </span><span class=n>ARRAY_AGG</span><span class=p>(</span><span class=n>random</span><span class=p>())::</span><span class=n>FLOAT4</span><span class=p>[]</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>vector</span>
<a id=__codelineno-0-4 name=__codelineno-0-4></a><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1280000</span><span class=p>)</span><span class=w> </span><span class=n>i</span>
<a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>10000</span><span class=p>;</span>
</code></pre></div></td></tr></table></div> <p>Spoiler alert: idiomatic Rust is about 10x faster than native SQL, embedded PL/pgSQL, and pure Python. Rust comes close to the hand-optimized assembly version of the Basic Linear Algebra Subroutines (BLAS) implementation. NumPy is supposed to provide optimizations in cases like this, but it's actually the worst performer. Data movement from Postgres to PL/Python is pretty good; it's even faster than the pure SQL equivalent, but adding the extra conversion from Python list to Numpy array takes almost as much time as everything else. Machine Learning systems that move relatively large quantities of data around can become dominated by these extraneous operations, rather than the ML algorithms that actually generate value.</p> <p><center> <iframe frameborder=0 height=371 scrolling=no seamless src="https://docs.google.com/spreadsheets/d/e/2PACX-1vShmCVrYwmscys5TIo7c_C-1M3gE_GwENc4tTiU7A6_l3YamjJx7v5bZcafLIDcEIbFu-C2Buao4rQ6/pubchart?oid=815608582&format=interactive" width=600></iframe> </center></p> <div class="tabbed-set tabbed-alternate" data-tabs=1:6><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><input id=__tabbed_1_3 name=__tabbed_1 type=radio><input id=__tabbed_1_4 name=__tabbed_1 type=radio><input id=__tabbed_1_5 name=__tabbed_1 type=radio><input id=__tabbed_1_6 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>SQL</label><label for=__tabbed_1_2>PL/pgSQL</label><label for=__tabbed_1_3>Python</label><label for=__tabbed_1_4>NumPy</label><label for=__tabbed_1_5>Rust</label><label for=__tabbed_1_6>BLAS</label></div> <div class=tabbed-content> <div class=tabbed-block> <p><div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>define_sql.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1>1</a></span>
<span class=normal><a href=#__codelineno-1-2>2</a></span>
<span class=normal><a href=#__codelineno-1-3>3</a></span>
<span class=normal><a href=#__codelineno-1-4>4</a></span>
<span class=normal><a href=#__codelineno-1-5>5</a></span>
<span class=normal><a href=#__codelineno-1-6>6</a></span>
<span class=normal><a href=#__codelineno-1-7>7</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>dot_product_sql</span><span class=p>(</span><span class=n>a</span><span class=w> </span><span class=n>FLOAT4</span><span class=p>[],</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=n>FLOAT4</span><span class=p>[])</span><span class=w> </span>
<a id=__codelineno-1-2 name=__codelineno-1-2></a><span class=w>    </span><span class=k>RETURNS</span><span class=w> </span><span class=n>FLOAT4</span>
<a id=__codelineno-1-3 name=__codelineno-1-3></a><span class=w>    </span><span class=k>LANGUAGE</span><span class=w> </span><span class=k>sql</span><span class=w> </span><span class=k>IMMUTABLE</span><span class=w> </span><span class=k>STRICT</span><span class=w> </span><span class=n>PARALLEL</span><span class=w> </span><span class=n>SAFE</span><span class=w> </span><span class=k>AS</span><span class=w> </span>
<a id=__codelineno-1-4 name=__codelineno-1-4></a><span class=err>$$</span>
<a id=__codelineno-1-5 name=__codelineno-1-5></a><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>multiplied</span><span class=p>.</span><span class=k>values</span><span class=p>)</span>
<a id=__codelineno-1-6 name=__codelineno-1-6></a><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>UNNEST</span><span class=p>(</span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>UNNEST</span><span class=p>(</span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>values</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>multiplied</span><span class=p>;</span>
<a id=__codelineno-1-7 name=__codelineno-1-7></a><span class=err>$$</span><span class=p>;</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>test_sql.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1>1</a></span>
<span class=normal><a href=#__codelineno-2-2>2</a></span>
<span class=normal><a href=#__codelineno-2-3>3</a></span>
<span class=normal><a href=#__codelineno-2-4>4</a></span>
<span class=normal><a href=#__codelineno-2-5>5</a></span>
<span class=normal><a href=#__codelineno-2-6>6</a></span>
<span class=normal><a href=#__codelineno-2-7>7</a></span>
<span class=normal><a href=#__codelineno-2-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1></a><span class=k>WITH</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-2-2 name=__codelineno-2-2></a><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>ARRAY_AGG</span><span class=p>(</span><span class=n>random</span><span class=p>())::</span><span class=n>FLOAT4</span><span class=p>[]</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>vector</span>
<a id=__codelineno-2-3 name=__codelineno-2-3></a><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>128</span><span class=p>)</span><span class=w> </span><span class=n>i</span>
<a id=__codelineno-2-4 name=__codelineno-2-4></a><span class=p>)</span>
<a id=__codelineno-2-5 name=__codelineno-2-5></a><span class=k>SELECT</span><span class=w> </span><span class=n>dot_product_sql</span><span class=p>(</span><span class=n>embeddings</span><span class=p>.</span><span class=n>vector</span><span class=p>,</span><span class=w> </span><span class=n>test</span><span class=p>.</span><span class=n>vector</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>dot_product</span>
<a id=__codelineno-2-6 name=__codelineno-2-6></a><span class=k>FROM</span><span class=w> </span><span class=n>embeddings</span><span class=p>,</span><span class=w> </span><span class=n>test</span>
<a id=__codelineno-2-7 name=__codelineno-2-7></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>1</span>
<a id=__codelineno-2-8 name=__codelineno-2-8></a><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span>
</code></pre></div></td></tr></table></div></p> </div> <div class=tabbed-block> <p><div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>define_plpgsql.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1>1</a></span>
<span class=normal><a href=#__codelineno-3-2>2</a></span>
<span class=normal><a href=#__codelineno-3-3>3</a></span>
<span class=normal><a href=#__codelineno-3-4>4</a></span>
<span class=normal><a href=#__codelineno-3-5>5</a></span>
<span class=normal><a href=#__codelineno-3-6>6</a></span>
<span class=normal><a href=#__codelineno-3-7>7</a></span>
<span class=normal><a href=#__codelineno-3-8>8</a></span>
<span class=normal><a href=#__codelineno-3-9>9</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>dot_product_plpgsql</span><span class=p>(</span><span class=n>a</span><span class=w> </span><span class=n>FLOAT4</span><span class=p>[],</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=n>FLOAT4</span><span class=p>[])</span>
<a id=__codelineno-3-2 name=__codelineno-3-2></a><span class=w>    </span><span class=k>RETURNS</span><span class=w> </span><span class=n>FLOAT4</span>
<a id=__codelineno-3-3 name=__codelineno-3-3></a><span class=w>    </span><span class=k>LANGUAGE</span><span class=w> </span><span class=n>plpgsql</span><span class=w> </span><span class=k>IMMUTABLE</span><span class=w> </span><span class=k>STRICT</span><span class=w> </span><span class=n>PARALLEL</span><span class=w> </span><span class=n>SAFE</span><span class=w> </span><span class=k>AS</span>
<a id=__codelineno-3-4 name=__codelineno-3-4></a><span class=err>$$</span>
<a id=__codelineno-3-5 name=__codelineno-3-5></a><span class=w>    </span><span class=k>BEGIN</span>
<a id=__codelineno-3-6 name=__codelineno-3-6></a><span class=w>        </span><span class=k>RETURN</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>multiplied</span><span class=p>.</span><span class=k>values</span><span class=p>)</span>
<a id=__codelineno-3-7 name=__codelineno-3-7></a><span class=w>        </span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>UNNEST</span><span class=p>(</span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>UNNEST</span><span class=p>(</span><span class=n>b</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>values</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>multiplied</span><span class=p>;</span>
<a id=__codelineno-3-8 name=__codelineno-3-8></a><span class=w>    </span><span class=k>END</span>
<a id=__codelineno-3-9 name=__codelineno-3-9></a><span class=err>$$</span><span class=p>;</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>test_plpgsql.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1>1</a></span>
<span class=normal><a href=#__codelineno-4-2>2</a></span>
<span class=normal><a href=#__codelineno-4-3>3</a></span>
<span class=normal><a href=#__codelineno-4-4>4</a></span>
<span class=normal><a href=#__codelineno-4-5>5</a></span>
<span class=normal><a href=#__codelineno-4-6>6</a></span>
<span class=normal><a href=#__codelineno-4-7>7</a></span>
<span class=normal><a href=#__codelineno-4-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1></a><span class=k>WITH</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-4-2 name=__codelineno-4-2></a><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>ARRAY_AGG</span><span class=p>(</span><span class=n>random</span><span class=p>())::</span><span class=n>FLOAT4</span><span class=p>[]</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>vector</span>
<a id=__codelineno-4-3 name=__codelineno-4-3></a><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>128</span><span class=p>)</span><span class=w> </span><span class=n>i</span>
<a id=__codelineno-4-4 name=__codelineno-4-4></a><span class=p>)</span>
<a id=__codelineno-4-5 name=__codelineno-4-5></a><span class=k>SELECT</span><span class=w> </span><span class=n>dot_product_plpgsql</span><span class=p>(</span><span class=n>embeddings</span><span class=p>.</span><span class=n>vector</span><span class=p>,</span><span class=w> </span><span class=n>test</span><span class=p>.</span><span class=n>vector</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>dot_product</span>
<a id=__codelineno-4-6 name=__codelineno-4-6></a><span class=k>FROM</span><span class=w> </span><span class=n>embeddings</span><span class=p>,</span><span class=w> </span><span class=n>test</span>
<a id=__codelineno-4-7 name=__codelineno-4-7></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>1</span>
<a id=__codelineno-4-8 name=__codelineno-4-8></a><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span>
</code></pre></div></td></tr></table></div></p> </div> <div class=tabbed-block> <p><div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>define_python.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1>1</a></span>
<span class=normal><a href=#__codelineno-5-2>2</a></span>
<span class=normal><a href=#__codelineno-5-3>3</a></span>
<span class=normal><a href=#__codelineno-5-4>4</a></span>
<span class=normal><a href=#__codelineno-5-5>5</a></span>
<span class=normal><a href=#__codelineno-5-6>6</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>dot_product_python</span><span class=p>(</span><span class=n>a</span><span class=w> </span><span class=n>FLOAT4</span><span class=p>[],</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=n>FLOAT4</span><span class=p>[])</span>
<a id=__codelineno-5-2 name=__codelineno-5-2></a><span class=w>    </span><span class=k>RETURNS</span><span class=w> </span><span class=n>FLOAT4</span>
<a id=__codelineno-5-3 name=__codelineno-5-3></a><span class=w>    </span><span class=k>LANGUAGE</span><span class=w> </span><span class=n>plpython3u</span><span class=w> </span><span class=k>IMMUTABLE</span><span class=w> </span><span class=k>STRICT</span><span class=w> </span><span class=n>PARALLEL</span><span class=w> </span><span class=n>SAFE</span><span class=w> </span><span class=k>AS</span><span class=w> </span>
<a id=__codelineno-5-4 name=__codelineno-5-4></a><span class=err>$$</span>
<a id=__codelineno-5-5 name=__codelineno-5-5></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>sum</span><span class=p>([</span><span class=n>a</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>zip</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>)])</span>
<a id=__codelineno-5-6 name=__codelineno-5-6></a><span class=err>$$</span><span class=p>;</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>test_python.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-1>1</a></span>
<span class=normal><a href=#__codelineno-6-2>2</a></span>
<span class=normal><a href=#__codelineno-6-3>3</a></span>
<span class=normal><a href=#__codelineno-6-4>4</a></span>
<span class=normal><a href=#__codelineno-6-5>5</a></span>
<span class=normal><a href=#__codelineno-6-6>6</a></span>
<span class=normal><a href=#__codelineno-6-7>7</a></span>
<span class=normal><a href=#__codelineno-6-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1></a><span class=k>WITH</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-6-2 name=__codelineno-6-2></a><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>ARRAY_AGG</span><span class=p>(</span><span class=n>random</span><span class=p>())::</span><span class=n>FLOAT4</span><span class=p>[]</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>vector</span>
<a id=__codelineno-6-3 name=__codelineno-6-3></a><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>128</span><span class=p>)</span><span class=w> </span><span class=n>i</span>
<a id=__codelineno-6-4 name=__codelineno-6-4></a><span class=p>)</span>
<a id=__codelineno-6-5 name=__codelineno-6-5></a><span class=k>SELECT</span><span class=w> </span><span class=n>dot_product_python</span><span class=p>(</span><span class=n>embeddings</span><span class=p>.</span><span class=n>vector</span><span class=p>,</span><span class=w> </span><span class=n>test</span><span class=p>.</span><span class=n>vector</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>dot_product</span>
<a id=__codelineno-6-6 name=__codelineno-6-6></a><span class=k>FROM</span><span class=w> </span><span class=n>embeddings</span><span class=p>,</span><span class=w> </span><span class=n>test</span>
<a id=__codelineno-6-7 name=__codelineno-6-7></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>1</span>
<a id=__codelineno-6-8 name=__codelineno-6-8></a><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span>
</code></pre></div></td></tr></table></div></p> </div> <div class=tabbed-block> <p><div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>define_numpy.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-7-1>1</a></span>
<span class=normal><a href=#__codelineno-7-2>2</a></span>
<span class=normal><a href=#__codelineno-7-3>3</a></span>
<span class=normal><a href=#__codelineno-7-4>4</a></span>
<span class=normal><a href=#__codelineno-7-5>5</a></span>
<span class=normal><a href=#__codelineno-7-6>6</a></span>
<span class=normal><a href=#__codelineno-7-7>7</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>dot_product_numpy</span><span class=p>(</span><span class=n>a</span><span class=w> </span><span class=n>FLOAT4</span><span class=p>[],</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=n>FLOAT4</span><span class=p>[])</span>
<a id=__codelineno-7-2 name=__codelineno-7-2></a><span class=w>    </span><span class=k>RETURNS</span><span class=w> </span><span class=n>FLOAT4</span>
<a id=__codelineno-7-3 name=__codelineno-7-3></a><span class=w>    </span><span class=k>LANGUAGE</span><span class=w> </span><span class=n>plpython3u</span><span class=w> </span><span class=k>IMMUTABLE</span><span class=w> </span><span class=k>STRICT</span><span class=w> </span><span class=n>PARALLEL</span><span class=w> </span><span class=n>SAFE</span><span class=w> </span><span class=k>AS</span><span class=w> </span>
<a id=__codelineno-7-4 name=__codelineno-7-4></a><span class=err>$$</span>
<a id=__codelineno-7-5 name=__codelineno-7-5></a><span class=w>    </span><span class=n>import</span><span class=w> </span><span class=n>numpy</span>
<a id=__codelineno-7-6 name=__codelineno-7-6></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>numpy</span><span class=p>.</span><span class=n>dot</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>)</span>
<a id=__codelineno-7-7 name=__codelineno-7-7></a><span class=err>$$</span><span class=p>;</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>test_numpy.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-8-1>1</a></span>
<span class=normal><a href=#__codelineno-8-2>2</a></span>
<span class=normal><a href=#__codelineno-8-3>3</a></span>
<span class=normal><a href=#__codelineno-8-4>4</a></span>
<span class=normal><a href=#__codelineno-8-5>5</a></span>
<span class=normal><a href=#__codelineno-8-6>6</a></span>
<span class=normal><a href=#__codelineno-8-7>7</a></span>
<span class=normal><a href=#__codelineno-8-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1></a><span class=k>WITH</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-8-2 name=__codelineno-8-2></a><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>ARRAY_AGG</span><span class=p>(</span><span class=n>random</span><span class=p>())::</span><span class=n>FLOAT4</span><span class=p>[]</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>vector</span>
<a id=__codelineno-8-3 name=__codelineno-8-3></a><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>128</span><span class=p>)</span><span class=w> </span><span class=n>i</span>
<a id=__codelineno-8-4 name=__codelineno-8-4></a><span class=p>)</span>
<a id=__codelineno-8-5 name=__codelineno-8-5></a><span class=k>SELECT</span><span class=w> </span><span class=n>dot_product_numpy</span><span class=p>(</span><span class=n>embeddings</span><span class=p>.</span><span class=n>vector</span><span class=p>,</span><span class=w> </span><span class=n>test</span><span class=p>.</span><span class=n>vector</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>dot_product</span>
<a id=__codelineno-8-6 name=__codelineno-8-6></a><span class=k>FROM</span><span class=w> </span><span class=n>embeddings</span><span class=p>,</span><span class=w> </span><span class=n>test</span>
<a id=__codelineno-8-7 name=__codelineno-8-7></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>1</span>
<a id=__codelineno-8-8 name=__codelineno-8-8></a><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span>
</code></pre></div></td></tr></table></div></p> </div> <div class=tabbed-block> <p><div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>define_rust.rs</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-9-1>1</a></span>
<span class=normal><a href=#__codelineno-9-2>2</a></span>
<span class=normal><a href=#__codelineno-9-3>3</a></span>
<span class=normal><a href=#__codelineno-9-4>4</a></span>
<span class=normal><a href=#__codelineno-9-5>5</a></span>
<span class=normal><a href=#__codelineno-9-6>6</a></span>
<span class=normal><a href=#__codelineno-9-7>7</a></span>
<span class=normal><a href=#__codelineno-9-8>8</a></span>
<span class=normal><a href=#__codelineno-9-9>9</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1></a><span class=cp>#[pg_extern(immutable, strict, parallel_safe)]</span>
<a id=__codelineno-9-2 name=__codelineno-9-2></a><span class=k>fn</span> <span class=nf>dot_product_rust</span><span class=p>(</span><span class=n>vector</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>f32</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>other</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>f32</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>f32</span> <span class=p>{</span>
<a id=__codelineno-9-3 name=__codelineno-9-3></a><span class=w>    </span><span class=n>vector</span>
<a id=__codelineno-9-4 name=__codelineno-9-4></a><span class=w>        </span><span class=p>.</span><span class=n>as_slice</span><span class=p>()</span>
<a id=__codelineno-9-5 name=__codelineno-9-5></a><span class=w>        </span><span class=p>.</span><span class=n>iter</span><span class=p>()</span>
<a id=__codelineno-9-6 name=__codelineno-9-6></a><span class=w>        </span><span class=p>.</span><span class=n>zip</span><span class=p>(</span><span class=n>other</span><span class=p>.</span><span class=n>as_slice</span><span class=p>().</span><span class=n>iter</span><span class=p>())</span>
<a id=__codelineno-9-7 name=__codelineno-9-7></a><span class=w>        </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>)</span><span class=o>|</span><span class=w> </span><span class=p>(</span><span class=n>a</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>b</span><span class=p>))</span>
<a id=__codelineno-9-8 name=__codelineno-9-8></a><span class=w>        </span><span class=p>.</span><span class=n>sum</span><span class=p>()</span>
<a id=__codelineno-9-9 name=__codelineno-9-9></a><span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>test_rust.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-10-1>1</a></span>
<span class=normal><a href=#__codelineno-10-2>2</a></span>
<span class=normal><a href=#__codelineno-10-3>3</a></span>
<span class=normal><a href=#__codelineno-10-4>4</a></span>
<span class=normal><a href=#__codelineno-10-5>5</a></span>
<span class=normal><a href=#__codelineno-10-6>6</a></span>
<span class=normal><a href=#__codelineno-10-7>7</a></span>
<span class=normal><a href=#__codelineno-10-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1></a><span class=k>WITH</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-10-2 name=__codelineno-10-2></a><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>ARRAY_AGG</span><span class=p>(</span><span class=n>random</span><span class=p>())::</span><span class=n>FLOAT4</span><span class=p>[]</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>vector</span>
<a id=__codelineno-10-3 name=__codelineno-10-3></a><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>128</span><span class=p>)</span><span class=w> </span><span class=n>i</span>
<a id=__codelineno-10-4 name=__codelineno-10-4></a><span class=p>)</span>
<a id=__codelineno-10-5 name=__codelineno-10-5></a><span class=k>SELECT</span><span class=w> </span><span class=n>pgml</span><span class=p>.</span><span class=n>dot_product_rust</span><span class=p>(</span><span class=n>embeddings</span><span class=p>.</span><span class=n>vector</span><span class=p>,</span><span class=w> </span><span class=n>test</span><span class=p>.</span><span class=n>vector</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>dot_product</span>
<a id=__codelineno-10-6 name=__codelineno-10-6></a><span class=k>FROM</span><span class=w> </span><span class=n>embeddings</span><span class=p>,</span><span class=w> </span><span class=n>test</span>
<a id=__codelineno-10-7 name=__codelineno-10-7></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>1</span>
<a id=__codelineno-10-8 name=__codelineno-10-8></a><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span>
</code></pre></div></td></tr></table></div></p> </div> <div class=tabbed-block> <p><div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>define_blas.rs</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-11-1> 1</a></span>
<span class=normal><a href=#__codelineno-11-2> 2</a></span>
<span class=normal><a href=#__codelineno-11-3> 3</a></span>
<span class=normal><a href=#__codelineno-11-4> 4</a></span>
<span class=normal><a href=#__codelineno-11-5> 5</a></span>
<span class=normal><a href=#__codelineno-11-6> 6</a></span>
<span class=normal><a href=#__codelineno-11-7> 7</a></span>
<span class=normal><a href=#__codelineno-11-8> 8</a></span>
<span class=normal><a href=#__codelineno-11-9> 9</a></span>
<span class=normal><a href=#__codelineno-11-10>10</a></span>
<span class=normal><a href=#__codelineno-11-11>11</a></span>
<span class=normal><a href=#__codelineno-11-12>12</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1></a><span class=cp>#[pg_extern(immutable, strict, parallel_safe)]</span>
<a id=__codelineno-11-2 name=__codelineno-11-2></a><span class=k>fn</span> <span class=nf>dot_product_blas</span><span class=p>(</span><span class=n>vector</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>f32</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>other</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>f32</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>f32</span> <span class=p>{</span>
<a id=__codelineno-11-3 name=__codelineno-11-3></a><span class=w>    </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-4 name=__codelineno-11-4></a><span class=w>        </span><span class=n>blas</span>::<span class=n>sdot</span><span class=p>(</span>
<a id=__codelineno-11-5 name=__codelineno-11-5></a><span class=w>            </span><span class=n>vector</span><span class=p>.</span><span class=n>len</span><span class=p>().</span><span class=n>try_into</span><span class=p>().</span><span class=n>unwrap</span><span class=p>(),</span>
<a id=__codelineno-11-6 name=__codelineno-11-6></a><span class=w>            </span><span class=n>vector</span><span class=p>.</span><span class=n>as_slice</span><span class=p>(),</span>
<a id=__codelineno-11-7 name=__codelineno-11-7></a><span class=w>            </span><span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-11-8 name=__codelineno-11-8></a><span class=w>            </span><span class=n>other</span><span class=p>.</span><span class=n>as_slice</span><span class=p>(),</span>
<a id=__codelineno-11-9 name=__codelineno-11-9></a><span class=w>            </span><span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-11-10 name=__codelineno-11-10></a><span class=w>        </span><span class=p>)</span>
<a id=__codelineno-11-11 name=__codelineno-11-11></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-11-12 name=__codelineno-11-12></a><span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>test_blas.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-12-1>1</a></span>
<span class=normal><a href=#__codelineno-12-2>2</a></span>
<span class=normal><a href=#__codelineno-12-3>3</a></span>
<span class=normal><a href=#__codelineno-12-4>4</a></span>
<span class=normal><a href=#__codelineno-12-5>5</a></span>
<span class=normal><a href=#__codelineno-12-6>6</a></span>
<span class=normal><a href=#__codelineno-12-7>7</a></span>
<span class=normal><a href=#__codelineno-12-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1></a><span class=k>WITH</span><span class=w> </span><span class=n>test</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-12-2 name=__codelineno-12-2></a><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>ARRAY_AGG</span><span class=p>(</span><span class=n>random</span><span class=p>())::</span><span class=n>FLOAT4</span><span class=p>[]</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>vector</span>
<a id=__codelineno-12-3 name=__codelineno-12-3></a><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>generate_series</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>128</span><span class=p>)</span><span class=w> </span><span class=n>i</span>
<a id=__codelineno-12-4 name=__codelineno-12-4></a><span class=p>)</span>
<a id=__codelineno-12-5 name=__codelineno-12-5></a><span class=k>SELECT</span><span class=w> </span><span class=n>pgml</span><span class=p>.</span><span class=n>dot_product_blas</span><span class=p>(</span><span class=n>embeddings</span><span class=p>.</span><span class=n>vector</span><span class=p>,</span><span class=w> </span><span class=n>test</span><span class=p>.</span><span class=n>vector</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>dot_product</span>
<a id=__codelineno-12-6 name=__codelineno-12-6></a><span class=k>FROM</span><span class=w> </span><span class=n>embeddings</span><span class=p>,</span><span class=w> </span><span class=n>test</span>
<a id=__codelineno-12-7 name=__codelineno-12-7></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=mi>1</span>
<a id=__codelineno-12-8 name=__codelineno-12-8></a><span class=k>LIMIT</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span>
</code></pre></div></td></tr></table></div></p> </div> </div> </div> <p>We're building with the Rust <a href=https://github.com/tcdi/pgrx/tree/master/pgrx>pgrx</a> crate that makes our development cycle even nicer than the one we use to manage Python. It really streamlines creating an extension in Rust, so all we have to worry about is writing our functions. It took about an hour to port all of our vector operations to Rust with BLAS support, and another week to port all the "business logic" for maintaining model training and deployment. We've even gained some new capabilities for caching models across connections (independent processes), now that we have access to Postgres shared memory, without having to worry about Python's GIL and GC. This is the dream of Apache's Arrow project, realized for our applications, without having to change the world, just our implementations. 🤩 Single-copy end-to-end machine learning, with parallel processing and shared data access.</p> <h2 id=what-about-xgboost-and-friends>What about XGBoost and friends?<a class=headerlink href=#what-about-xgboost-and-friends title="Permanent link">¶</a></h2> <p>ML isn't just about basic math and a little bit of business logic. It's about all those complicated algorithms beyond linear regression for gradient boosting and deep learning. The good news is that most of these libraries are implemented in C/C++, and just have Python bindings. There are also bindings for Rust (<a href=https://github.com/vaaaaanquish/lightgbm-rs>lightgbm</a>, <a href=https://github.com/davechallis/rust-xgboost>xgboost</a>, <a href=https://github.com/tensorflow/rust>tensorflow</a>, <a href=https://github.com/LaurentMazare/tch-rs>torch</a>).</p> <figure> <a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=/blog/images/abstraction.webp><img alt="It's all abstraction" src=/blog/images/abstraction.webp></a> <figcaption>Layers of abstraction must remain a good value.</figcaption> </figure> <p>The results are somewhat staggering. We didn't spend any time intentionally optimizing Rust over Python. Most of the time spent was just trying to get things to compile. 😅 It's hard to believe the difference is this big, but those fringe operations outside of the core machine learning algorithms really do dominate, requiring up to 35x more time in Python during inference. The difference between classification and regression speeds here are related to the dataset size. The scikit learn handwritten image classification dataset effectively has 64 features (pixels) vs the diabetes regression dataset having only 10 features. </p> <p><strong>The more data we're dealing with, the bigger the improvement we see in Rust</strong>. We're even giving Python some leeway by warming up the runtime on the connection before the test, which typically takes a second or two to interpret all of PostgresML's dependencies. Since Rust is a compiled language, there is no longer a need to warmup the connection. </p> <p><center> <iframe frameborder=0 height=371 scrolling=no seamless src="https://docs.google.com/spreadsheets/d/e/2PACX-1vShmCVrYwmscys5TIo7c_C-1M3gE_GwENc4tTiU7A6_l3YamjJx7v5bZcafLIDcEIbFu-C2Buao4rQ6/pubchart?oid=345126465&format=interactive" width=600></iframe> </center></p> <blockquote> <p><em>This language comparison uses in-process data access. Python based machine learning microservices that communicate with other services over HTTP with JSON or gRPC interfaces will look even worse in comparison, especially if they are stateless and rely on yet another database to provide their data over yet another wire.</em></p> </blockquote> <h2 id=preserving-backward-compatibility>Preserving Backward Compatibility<a class=headerlink href=#preserving-backward-compatibility title="Permanent link">¶</a></h2> <div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>train.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-13-1>1</a></span>
<span class=normal><a href=#__codelineno-13-2>2</a></span>
<span class=normal><a href=#__codelineno-13-3>3</a></span>
<span class=normal><a href=#__codelineno-13-4>4</a></span>
<span class=normal><a href=#__codelineno-13-5>5</a></span>
<span class=normal><a href=#__codelineno-13-6>6</a></span>
<span class=normal><a href=#__codelineno-13-7>7</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>pgml</span><span class=p>.</span><span class=n>train</span><span class=p>(</span>
<a id=__codelineno-13-2 name=__codelineno-13-2></a><span class=w>  </span><span class=n>project_name</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>'Handwritten Digit Classifier'</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-13-3 name=__codelineno-13-3></a><span class=w>  </span><span class=n>task</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>'classification'</span><span class=p>,</span>
<a id=__codelineno-13-4 name=__codelineno-13-4></a><span class=w>  </span><span class=n>relation_name</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>'pgml.digits'</span><span class=p>,</span>
<a id=__codelineno-13-5 name=__codelineno-13-5></a><span class=w>  </span><span class=n>y_column_name</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>'target'</span><span class=p>,</span>
<a id=__codelineno-13-6 name=__codelineno-13-6></a><span class=w>  </span><span class=n>algorithm</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s1>'xgboost'</span><span class=w> </span>
<a id=__codelineno-13-7 name=__codelineno-13-7></a><span class=p>);</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><th class=filename colspan=2><span class=filename>train.sql</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-14-1>1</a></span>
<span class=normal><a href=#__codelineno-14-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>pgml</span><span class=p>.</span><span class=n>predict</span><span class=p>(</span><span class=s1>'Handwritten Digit Classifier'</span><span class=p>,</span><span class=w> </span><span class=n>image</span><span class=p>)</span>
<a id=__codelineno-14-2 name=__codelineno-14-2></a><span class=k>FROM</span><span class=w> </span><span class=n>pgml</span><span class=p>.</span><span class=n>digits</span><span class=p>;</span>
</code></pre></div></td></tr></table></div> <p>The API is identical between v1.0 and v2.0. We take breaking changes seriously and we're not going to break existing deployments just because we're rewriting the whole project. The only reason we're bumping the major version is because we feel like this is a dramatic change, but we intend to preserve a full compatibility layer with models trained on v1.0 in Python. However, this does mean that to get the full performance benefits, you'll need to retrain models after upgrading.</p> <h2 id=ensuring-high-quality-rust-implementations>Ensuring High Quality Rust Implementations<a class=headerlink href=#ensuring-high-quality-rust-implementations title="Permanent link">¶</a></h2> <p>Besides backwards compatibility, we're building a Python compatibility layer to guarantee we can preserve the full Python model training APIs, when Rust APIs are not at parity in terms of functionality, quality or performance. We started this journey thinking that the older vanilla Python algorithms in Scikit would be the best candidates for replacement in Rust, but that is only partly true. There are high quality efforts in <a href=https://github.com/rust-ml/linfa>linfa</a> and <a href=https://github.com/smartcorelib/smartcore>smartcore</a> that also show 10-30x speedup over Scikit, but they still lack some of the deeper functionality like joint regression, some of the more obscure algorithms and hyperparameters, and some of the error handling that has been hardened into Scikit with mass adoption.</p> <p><center> <iframe frameborder=0 height=371 scrolling=no seamless src="https://docs.google.com/spreadsheets/d/e/
2PACX-1vShmCVrYwmscys5TIo7c_C-1M3gE_GwENc4tTiU7A6_l3YamjJx7v5bZcafLIDcEIbFu-C2Buao4rQ6/pubchart?oid=1042030978&format=interactive" width=600></iframe> </center></p> <p>We see similar speed up in prediction time for the Rust implementations of classic algorithms.</p> <p><center> <iframe frameborder=0 height=371 scrolling=no seamless src="https://docs.google.com/spreadsheets/d/e/2PACX-1vShmCVrYwmscys5TIo7c_C-1M3gE_GwENc4tTiU7A6_l3YamjJx7v5bZcafLIDcEIbFu-C2Buao4rQ6/pubchart?oid=1116793076&format=interactive" width=600></iframe> </center></p> <p>The Rust implementations also produce high quality predictions against test sets, although there is not perfect parity in the implementations where different optimizations have been chosen by default.</p> <p><center> <iframe frameborder=0 height=371 scrolling=no seamless src="https://docs.google.com/spreadsheets/d/e/2PACX-1vShmCVrYwmscys5TIo7c_C-1M3gE_GwENc4tTiU7A6_l3YamjJx7v5bZcafLIDcEIbFu-C2Buao4rQ6/pubchart?oid=631927399&format=interactive" width=600></iframe> </center></p> <p>Interestingly, the training times for some of the simplest algorithms are worse in the Rust implementation. Until we can guarantee each Rust algorithm is an upgrade in every way, we'll continue to use the Python compatibility layer on a case by case basis to avoid any unpleasant surprises.</p> <p>We believe that <a href=https://www.arewelearningyet.com/ >machine learning in Rust</a> is mature enough to add significant value now. We'll be using the same underlying C/C++ libraries, and it's worth contributing to the Rust ML ecosystem to bring it up to full feature parity. Our v2.0 release will include a benchmark suite for the full API we support via all Python libraries, so that we can track our progress toward pure Rust implementations over time.</p> <p>Many thanks and ❤️ to all those who are supporting this endeavor. We’d love to hear feedback from the broader ML and Engineering community about applications and other real world scenarios to help prioritize our work. You can show your support by <a href=https://github.com/postgresml/postgresml>starring us on our GitHub</a>.</p> <p><center> <br> <video autoplay controls loop muted style="box-shadow: 0 0 8px #000;" width=90%> <source src=https://static.postgresml.org/postgresml-org-static/gym_demo.webm type=video/webm> <source src=https://static.postgresml.org/postgresml-org-static/gym_demo.mp4 type=video/mp4> <a class=glightbox data-desc-position=bottom data-height=auto data-width=100% href=/images/demos/gym_demo.png><img alt="PostgresML in practice" loading=lazy src=/images/demos/gym_demo.png></a> </video></center></p> <p></p> <p><center markdown> <a href=https://cloud.postgresml.org/ class="md-button md-button--primary">Try the PostgresML Gym</a> </center></p> <h2 id=__comments>Comments</h2> <script async crossorigin=anonymous data-category=Announcements data-category-id=DIC_kwDOHJ_hQM4CQctz data-emit-metadata=0 data-input-position=top data-lang=en data-mapping=title data-reactions-enabled=1 data-repo=postgresml/postgresml data-repo-id=R_kgDOHJ_hQA data-strict=0 data-theme=light src=https://giscus.app/client.js>
</script> <script>
  var giscus = document.querySelector("script[src*=giscus]")

  /* Set palette on initial load */
  var palette = __md_get("__palette")
  if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate" ? "dark" : "light"
    giscus.setAttribute("data-theme", theme) 
  }

  /* Register event handlers after documented loaded */
  document.addEventListener("DOMContentLoaded", function() {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function() {
      var palette = __md_get("__palette")
      if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"

        /* Instruct Giscus to change theme */
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
          { giscus: { setConfig: { theme } } },
          "https://giscus.app"
        )
      }
    })
  })
</script> </article> </div> </div> <a class="md-top md-icon" data-md-component=top hidden href=#> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </a> </main> <footer class=md-footer> <nav aria-label=Footer class="md-footer__inner md-grid"> <a aria-label="Previous: Oxidizing Machine Learning" class="md-footer__link md-footer__link--prev" href=../oxidizing-machine-learning/ rel=prev> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Oxidizing Machine Learning </div> </div> </a> <a aria-label="Next: Backwards Compatible or Bust: Python Inside Rust Inside Postgres" class="md-footer__link md-footer__link--next" href=../backwards-compatible-or-bust-python-inside-rust-inside-postgres/ rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Backwards Compatible or Bust: Python Inside Rust Inside Postgres </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright © 2022 PostgresML Team </div> </div> <div class=md-social> <a class=md-social__link href=https://github.com/postgresml/postgresml rel=noopener target=_blank title=github.com> <svg viewbox="0 0 496 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg> </a> <a class=md-social__link href=https://discord.gg/DmyJP3qJ7U rel=noopener target=_blank title=discord.gg> <svg viewbox="0 0 640 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.top", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.5a2dcb6a.min.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body> </html>