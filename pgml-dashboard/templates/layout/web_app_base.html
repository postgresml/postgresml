<% 
    use crate::templates::components::{
        NavbarWebApp,
        LeftNavWebApp,
        Breadcrumbs,
        NavLink,
        Nav
    }; 
%>

<%
pub fn dropdown<'a>(links: HashMap<String, String>, active: models::Cluster) -> Nav<'a> {
    let mut dropdown_nav: Nav = Nav { 
        links: vec![]
    };

    let names: Vec<String> = links.clone().into_keys().collect();

    if crate::utils::config::standalone_dashboard() {
        dropdown_nav.add_link(NavLink::new(&names[0], "/dashboard").active());
        return dropdown_nav
    }

    let new_link = NavLink::new("Dashboard", "/clusters");
    
    if names.contains(&active.name) {
        dropdown_nav.add_link(new_link);
    } else {
        dropdown_nav.add_link(new_link.active());
    }
    
    for (name, id) in links {
        let new_link = NavLink::new(&name, &format!("/clusters/switch/{}", id));
        
        if name.clone() == active.name {
            dropdown_nav.add_link(new_link.active());
        } else {
        dropdown_nav.add_link(new_link);
        }
    }

    dropdown_nav
}
%>

<%
    let dropdown_nav = dropdown(visible_clusters.clone(), current_cluster.clone());

    // collect left nav links for for top nav in mobile view
    let mut left_nav_links: Vec<NavLink> = Vec::new();
    left_nav_links.append(& mut upper_nav.links.clone());
    left_nav_links.append(& mut lower_nav.links.clone());
%>

<!DOCTYPE html>
<html lang="en-US" data-bs-theme="dark">
    <%- head %>
    <body>
        <main>
            <div class="container-fluid p-0 min-vh-lg-100">
                <div class="row gx-0 min-vh-lg-100">
                    <%- NavbarWebApp::render( None, left_nav_links ) %>

                    <div class="d-flex">
                        <div class="leftnav-container py-3 z-1" >
                            <%- LeftNavWebApp::render( upper_nav, lower_nav, dropdown_nav ) %>
                        </div>
    
                        <div class="clear-from-under-navbar flex-grow-1">
                            <div class="px-5 py-3">
                                <%- Breadcrumbs::render( breadcrumbs ) %>
                            </div>

                            <div class="p-5">
                                <%- content.unwrap_or_default() %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3"></div>
    </body>
</html>
